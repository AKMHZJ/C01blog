<div class="post-page font-sans" *ngIf="post" [ngClass]="isDark ? 'theme-dark' : 'theme-light'">
  <div class="container">
    <button (click)="goBack()" class="back-btn">
      <mat-icon>arrow_back</mat-icon> Back to Feed
    </button>

    <article class="post-article">
      <header class="post-header">
        <div class="author-meta">
          <img [src]="post.author?.avatar | imageUrl:'https://placehold.co/40'" alt="Author">
          <div>
            <div style="font-weight: 500;">{{ post.author?.displayName || post.author?.username }}</div>
            <div style="opacity: 0.5; font-size: 0.875rem;">{{ post.date | date:'longDate' }}</div>
          </div>
        </div>
        <h1 class="font-serif">{{ post.title }}</h1>
        <p style="font-size: 1.125rem; opacity: 0.7;">{{ post.excerpt }}</p>
      </header>

      <img [src]="post.image | imageUrl:'https://placehold.co/1200x600'" [alt]="post.title" class="post-hero-image">

      <div class="post-content">
        <p *ngFor="let paragraph of post.content">{{ paragraph }}</p>
      </div>

      <div class="flex items-center gap-6 py-4" style="border-top: 1px solid rgba(128,128,128,0.2); border-bottom: 1px solid rgba(128,128,128,0.2);">
        <button (click)="handleLike()" class="flex items-center gap-2 bg-transparent border-none cursor-pointer" style="color: inherit;">
          <mat-icon [style.color]="isLiked ? '#ef4444' : 'inherit'">{{ isLiked ? 'favorite' : 'favorite_border' }}</mat-icon>
          <span>{{ post.likes.length || 0 }}</span>
        </button>
      </div>

      <section class="comment-section">
        <h2 class="font-serif text-2xl mb-6">Comments ({{ post.comments.length || 0 }})</h2>

        <div *ngIf="currentUser" style="margin-bottom: 2rem;">
          <form (ngSubmit)="handleCommentSubmit()">
            <textarea [(ngModel)]="commentText" name="commentText" rows="3" class="comment-input" placeholder="Write a comment..."></textarea>
            <div style="text-align: right;">
              <button type="submit" class="btn-primary" [disabled]="!commentText.trim()">Post Comment</button>
            </div>
          </form>
        </div>

        <div class="space-y-8">
          <div *ngFor="let comment of post.comments" class="comment-card">
            <img [src]="comment.author?.avatar | imageUrl:'https://placehold.co/40'" alt="Author" class="comment-avatar">
            
            <div class="comment-content-wrapper">
              <div class="comment-header">
                <div class="author-info">
                  <span class="author-name">{{ comment.author?.displayName || comment.author?.username }}</span>
                  <span class="comment-date">{{ formatTimestamp(comment.timestamp) }}</span>
                </div>
                
                <div class="comment-actions" *ngIf="isOwnComment(comment) && editingCommentId !== comment.id">
                  <button (click)="startEdit(comment)" class="text-btn edit">
                    <mat-icon>edit</mat-icon> Edit
                  </button>
                  <button (click)="handleDeleteComment(comment.id)" class="text-btn delete">
                    <mat-icon>delete</mat-icon> Delete
                  </button>
                </div>
              </div>
              
              @if (editingCommentId && editingCommentId === comment.id) {
                <div class="edit-comment-box">
                  <textarea [(ngModel)]="editText" class="comment-input" rows="3" placeholder="Update your comment..."></textarea>
                  <div class="flex gap-3 justify-end mt-2">
                    <button (click)="cancelEdit()" class="action-btn small">Cancel</button>
                    <button (click)="saveEdit(comment.id)" class="btn-primary small" [disabled]="!editText.trim()">Save Changes</button>
                  </div>
                </div>
              } @else {
                <div class="comment-text">
                  {{ comment.text }}
                </div>
              }
            </div>
          </div>
          <p *ngIf="!post.comments.length" style="opacity: 0.4; text-align: center; padding: 2rem 0;">No comments yet.</p>
        </div>
      </section>
    </article>
  </div>
</div>
